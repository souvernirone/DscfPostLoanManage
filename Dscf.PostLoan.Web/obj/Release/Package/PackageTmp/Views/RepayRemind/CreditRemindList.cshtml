@using System.Web.Optimization
@{
    ViewBag.Title = "还款提醒";
}

<div class="g-mn1c tb">
    <ul class="m-tnav">
        <li class="active">
            <a data-href="#xin">信贷</a>
        </li>
    </ul>
    <div class="tab-content">
        <div class="table-responsive tab-pane active" id="xin">
            <table class="table table-bordered noborder">
                <thead>
                    <tr>
                        <th>操作人</th>
                        <th>地区</th>
                        <th>姓名</th>
                        <th>联系方式</th>
                        <th>产品类型</th>
                        <th>合同金额</th>
                        <th>月还金额</th>
                        <th>操作</th>
                        <th>状态 @ViewBag.CreditCount.ShortNum/@ViewBag.CreditCount.AllNum </th>
                    </tr>
                </thead>
                <tbody id="container"></tbody>
            </table>
        </div>
    </div>
    <!--分页局部视图-->
    <div>@Html.Partial("_PartialPager")</div>
</div>

@section scripts
{
    @Scripts.Render("~/bundles/dialog")
    @Scripts.Render("~/bundles/dataPagerJs")
    @Scripts.Render("~/bundles/dataFormat")
    <script type="text/javascript">

        $(function () {

            getPageCreditRemindList();

            $(document).on("click", ".switch-animate", function () {
                var parms = {};
                parms.IsRemind = !$(this).hasClass("switch-on");
                parms.RepayId = $(this).attr("data-repayid");


                if (!parms.IsRemind) {
                    $(this).removeClass("switch-on").addClass("switch-off");

                }
                else {
                    $(this).addClass("switch-on").removeClass("switch-off");
                }
                $.ajax({
                    url: "/RepayRemind/UpdateCreditRemind",
                    method: "post",
                    async: true,
                    dataType: "json",
                    data: parms,
                    success: function (result) {
                        if (result.ReturnType == false)
                            new Alert().AlertInfo({
                                content: result.ReturnMsg,
                                iClass: 'error'
                            });
                    }
                });


            });

        });

        function getPageCreditRemindList() {
            var page = new Page();
            page.Url = "/RepayRemind/GetPageCreditRemindList";
            page.Container = $("#container");
            page.CallBack = function (data) {
                $("#container").empty();
                $.each(data, function (index, item) {
                    item.IsRemind = item.IsRemind ? "switch-on" : "switch-off";
                    $("#templete").tmpl(item).appendTo($("#container"));
                });
            };
            page.GetPageData();
        }
    </script>
    <script id="templete" type="text/x-jquery-tmpl">
        <tr id="row-${OrderId}">
            <td>${CollectorName}</td>
            <td>${SignCity}</td>
            <td>${UserName}</td>
            <td>${UserPhone}</td>
            <td>${ProductName}</td>
            <td>${Amount}</td>
            <td>${MonthRepay}</td>
            <td>
                <a class="u-b-one s-b-blue " target="_blank" href="/RepayRemind/CreditRemindDetail?orderId=${OrderId}&repayId=${RepayId}&css=1057">提</a>
            </td>
            <td>
                <div class="switch has-switch">
                    <div class="${IsRemind} switch-animate" data-repayid="${RepayId}">
                        <input type="checkbox" checked="">
                        <span class="switch-left">已提醒</span><label>&nbsp;</label><span class="switch-right">未提醒</span>
                    </div>
                </div>
            </td>
        </tr>
    </script>
}

